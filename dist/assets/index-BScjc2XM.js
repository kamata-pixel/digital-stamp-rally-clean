(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function n(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(t){if(t.ep)return;t.ep=!0;const s=n(t);fetch(t.href,s)}})();const r=[{id:"A",keyword:"あい",x:89.17,y:83.33},{id:"B",keyword:"うえ",x:89.17,y:70},{id:"C",keyword:"おか",x:89.17,y:56.67},{id:"D",keyword:"きく",x:89.17,y:43.33},{id:"E",keyword:"けこ",x:89.17,y:30},{id:"F",keyword:"さし",x:89.17,y:16.67},{id:"G",keyword:"すせ",x:89.17,y:3.33},{id:"H",keyword:"そた",x:46.67,y:83.33},{id:"I",keyword:"ちつ",x:33.33,y:16.67},{id:"J",keyword:"てと",x:46.67,y:16.67},{id:"K",keyword:"なに",x:46.67,y:3.33},{id:"L",keyword:"ぬね",x:33.33,y:83.33},{id:"M",keyword:"のは",x:20,y:83.33},{id:"N",keyword:"ひふ",x:6.67,y:83.33},{id:"O",keyword:"へほ",x:6.67,y:16.67},{id:"P",keyword:"まみ",x:20,y:16.67}],y=document.getElementById("map"),i=document.getElementById("stampInput"),u=document.getElementById("submitStamp"),l=document.getElementById("survey-container"),p=document.getElementById("actual-form"),c=document.getElementById("thanks-message");function m(){JSON.parse(localStorage.getItem("stampedHouses")||"[]").length===r.length&&(l.style.display="flex")}function f(){const o=r.filter(e=>document.getElementById(e.id).classList.contains("stamped")).map(e=>e.id);localStorage.setItem("stampedHouses",JSON.stringify(o))}function g(){JSON.parse(localStorage.getItem("stampedHouses")||"[]").forEach(e=>{const n=document.getElementById(e);n&&n.classList.add("stamped")}),m()}function v(){const o=new Date().toLocaleDateString();localStorage.getItem("lastVisitDate")!==o&&(localStorage.removeItem("stampedHouses"),localStorage.setItem("lastVisitDate",o))}window.addEventListener("DOMContentLoaded",()=>{v(),r.forEach(o=>{const e=document.createElement("div"),n=document.createElement("span");e.className="house",e.id=o.id,n.innerText=`モデル ${o.id}`,e.style.left=o.x+"%",e.style.top=o.y+"%",e.appendChild(n),y.appendChild(e)}),g()});u.addEventListener("click",()=>{const o=i.value.trim().toLowerCase();let e=!1;r.forEach(n=>{if(o===n.keyword){const a=document.getElementById(n.id);a.classList.contains("stamped")||(a.classList.add("stamped"),e=!0)}}),e?(f(),m()):alert("キーワードが違うか、すでにスタンプ済みです。"),i.value=""});p.addEventListener("submit",async o=>{o.preventDefault();const e=document.getElementById("favoriteHouse").value,n=document.querySelectorAll('input[name="q2"]:checked'),a=Array.from(n).map(d=>d.value),t=document.getElementById("goodStaff").value,s={favoriteHouse:e,impressivePoints:a,goodStaff:t,submittedAt:new Date().toISOString()};try{(await fetch("http://localhost:3000/api/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok?(l.style.display="none",c.style.display="block",setTimeout(()=>{c.style.display="none"},2e3)):alert("送信に失敗しました。もう一度お試しください。")}catch(d){console.error("送信エラー:",d),alert("サーバーとの通信に失敗しました。")}});
